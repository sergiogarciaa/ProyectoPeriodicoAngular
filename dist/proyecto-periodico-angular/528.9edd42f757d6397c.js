"use strict";(self.webpackChunkProyectoPeriodicoAngular=self.webpackChunkProyectoPeriodicoAngular||[]).push([[528],{8528:(F,f,n)=>{n.r(f),n.d(f,{AdministrarModule:()=>N});var c=n(6814),i=n(95),l=n(9692),y=n(7398),x=n(3519),m=n.n(x),e=n(5879),b=n(5449),g=n(8215);function Z(t,u){if(1&t&&(e.TgZ(0,"a",22),e._uU(1," Editar "),e.qZA()),2&t){const r=e.oxw().$implicit;e.MGl("routerLink","/administracion/editar-usuario/",r.id,"")}}function A(t,u){1&t&&(e.TgZ(0,"a",18),e._uU(1,"X"),e.qZA())}function k(t,u){if(1&t){const r=e.EpF();e.TgZ(0,"a",23),e.NdJ("click",function(){e.CHM(r);const a=e.oxw().$implicit,s=e.oxw(2);return e.KtG(s.eliminar(a.id,a.email))}),e._uU(1,"Borrar"),e.qZA()}}function U(t,u){if(1&t&&(e.TgZ(0,"tr",16)(1,"th",17),e._uU(2),e.qZA(),e.TgZ(3,"td",18),e._uU(4),e.qZA(),e.TgZ(5,"td",18),e._uU(6),e.qZA(),e.TgZ(7,"td",18),e._uU(8),e.qZA(),e.TgZ(9,"td",18),e._uU(10),e.qZA(),e.TgZ(11,"td",18),e._uU(12),e.ALo(13,"date"),e.qZA(),e.TgZ(14,"td",18),e.YNc(15,Z,2,1,"a",19),e.YNc(16,A,2,0,"a",20),e.qZA(),e.TgZ(17,"td",18),e.YNc(18,k,2,0,"a",21),e.qZA()()),2&t){const r=u.$implicit;e.xp6(2),e.Oqu(r.nombre),e.xp6(2),e.Oqu(r.apellidos),e.xp6(2),e.Oqu(r.email),e.xp6(2),e.Oqu(r.telefono),e.xp6(2),e.Oqu(r.rol),e.xp6(2),e.Oqu(e.xi3(13,9,r.fechaRegistro,"dd/MM/yyyy HH:mm:ss")),e.xp6(3),e.Q6J("ngIf","Admin"!==r.rol),e.xp6(1),e.Q6J("ngIf","Admin"===r.rol),e.xp6(2),e.Q6J("ngIf",r.id)}}function v(t,u){if(1&t&&(e.TgZ(0,"table",12)(1,"thead",13)(2,"tr")(3,"th",14),e._uU(4,"Nombre"),e.qZA(),e.TgZ(5,"th",14),e._uU(6,"Apellidos"),e.qZA(),e.TgZ(7,"th",14),e._uU(8,"Email"),e.qZA(),e.TgZ(9,"th",14),e._uU(10,"Telefono"),e.qZA(),e.TgZ(11,"th",14),e._uU(12,"Rol"),e.qZA(),e.TgZ(13,"th",14),e._uU(14,"Fecha de Creacion"),e.qZA(),e.TgZ(15,"th",14),e._uU(16,"Editar"),e.qZA(),e.TgZ(17,"th",14),e._uU(18,"Eliminar"),e.qZA()()(),e.TgZ(19,"tbody"),e.YNc(20,U,19,12,"tr",15),e.qZA()()),2&t){const r=e.oxw();e.xp6(20),e.Q6J("ngForOf",r.usuarios)}}let _=(()=>{class t{constructor(r,o,a){this.auth=r,this.baseDatos=o,this.router=a,this.usuarios=[]}ngOnInit(){this.obtenerUsuarios()}obtenerUsuarios(){this.baseDatos.obtenerTodos("usuarios").pipe((0,y.U)(r=>r.map(o=>({...o,fechaRegistro:this.convertirTimestampADate(o.fechaRegistro)})))).subscribe(r=>{this.usuarios=r,console.log(this.usuarios)})}convertirTimestampADate(r){return r instanceof Date?r:r&&"function"==typeof r.toDate?r.toDate():r&&"number"==typeof r.seconds?new Date(1e3*r.seconds):new Date}eliminar(r,o){const a=this.usuarios.find(s=>s.id===r);"Admin"!==a.rol?this.baseDatos.eliminar("usuarios",r).then(()=>{console.log("usuario eliminado"),this.auth.borrarUsuario(a),m().fire("Borrar usuario completado!","Se ha eliminado al usuario","success")}).catch(s=>{console.log(s)}):m().fire("\xa1No  se puede!","No se puede eliminar a un administrador","info")}logOut(){this.auth.logout()}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(b.e),e.Y36(g.g),e.Y36(l.F0))};static#r=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-ver-panel"]],decls:18,vars:1,consts:[[1,"bg-gray-50","dark:bg-gray-900","h-screen","text-white"],[1,"flex","justify-between","pt-4","pl-10"],[1,"justify-center","flex"],[1,"h-auto","text-3xl","text-gray-900","dark:text-gray-50"],[1,"flex","justify-end","py-2","pr-5","gap-5"],["routerLink","/principal/dashboard",1,"w-32","text-white","bg-red-600","hover:bg-red-500","focus:ring-4","focus:outline-none","focus:ring-red-500","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-red-600","dark:hover:bg-red-700","dark:focus:ring-red-800"],[1,"w-28","text-white","bg-red-600","hover:bg-red-500","focus:ring-4","focus:outline-none","focus:ring-red-500","font-medium","rounded-lg","text-sm","px-5","py-2.5","text-center","dark:bg-red-600","dark:hover:bg-red-700","dark:focus:ring-red-800",3,"click"],[1,"py-4","mt-5",2,"display","flex","justify-content","center"],[1,"card","bg-transparent"],[1,"card-header","mb-5"],[1,"relative","overflow-x-auto"],["class","w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400",4,"ngIf"],[1,"w-full","text-sm","text-left","rtl:text-right","text-gray-500","dark:text-gray-400"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50","dark:bg-gray-700","dark:text-gray-400"],["scope","col",1,"px-6","py-3"],["class","bg-white border-b dark:bg-gray-800 dark:border-gray-700",4,"ngFor","ngForOf"],[1,"bg-white","border-b","dark:bg-gray-800","dark:border-gray-700"],["scope","row",1,"px-6","py-4","font-medium","text-gray-900","whitespace-nowrap","dark:text-white"],[1,"px-6","py-4"],["class","btn buttonPrincipal",3,"routerLink",4,"ngIf"],["class","px-6 py-4",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"btn","buttonPrincipal",3,"routerLink"],[1,"btn","btn-danger",3,"click"]],template:function(o,a){1&o&&(e.TgZ(0,"main",0)(1,"div",1)(2,"div",2)(3,"h2",3),e._uU(4,"Administracion"),e.qZA()(),e.TgZ(5,"div",4)(6,"a",5),e._uU(7,"Volver"),e.qZA(),e.TgZ(8,"button",6),e.NdJ("click",function(){return a.logOut()}),e._uU(9,"Salir"),e.qZA()()(),e._UZ(10,"hr"),e.TgZ(11,"div",7)(12,"div",8)(13,"div",9)(14,"h3"),e._uU(15,"Listado usuarios"),e.qZA()(),e.TgZ(16,"div",10),e.YNc(17,v,21,1,"table",11),e.qZA()()()()),2&o&&(e.xp6(17),e.Q6J("ngIf",a.usuarios.length>0))},dependencies:[c.sg,c.O5,l.rH,c.uU]})}return t})(),T=(()=>{class t{constructor(r,o,a,s){this.route=r,this.baseDatosServicio=o,this.formBuilder=a,this.router=s,this.formularioEditarUsuario=this.formBuilder.group({email:["",i.kI.required],nombre:["",i.kI.required],apellidos:["",i.kI.required],telefono:["",i.kI.required],rol:["",i.kI.required]})}ngOnInit(){this.route.params.subscribe(r=>{this.idUsuario=r.id}),void 0!==this.idUsuario&&this.baseDatosServicio.obtenerPorId("usuarios",this.idUsuario).subscribe(r=>{this.usuario=r,this.formularioEditarUsuario.setValue({email:r.email,nombre:r.nombre,apellidos:r.apellidos,telefono:r.telefono,rol:r.rol})})}editarUsuario(){this.baseDatosServicio.actualizar("usuarios",{id:this.idUsuario,email:this.formularioEditarUsuario.value.email,nombre:this.formularioEditarUsuario.value.nombre,apellidos:this.formularioEditarUsuario.value.apellidos,telefono:this.formularioEditarUsuario.value.telefono,rol:this.formularioEditarUsuario.value.rol}).then(()=>{this.router.navigate(["/administracion/ver-panel"]),m().fire("Editar usuario completado!","Se ha editado correctamente al usuario","success")})}static#e=this.\u0275fac=function(o){return new(o||t)(e.Y36(l.gz),e.Y36(g.g),e.Y36(i.qu),e.Y36(l.F0))};static#r=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-editar-usuario"]],decls:41,vars:1,consts:[[1,"bg-slate-900"],[1,"form",3,"formGroup","ngSubmit"],[1,"flex","flex-col","items-center","justify-center","px-6","py-8","mx-auto","md:h-screen","lg:py-0"],["href","#",1,"flex","items-center","mb-6","text-2xl","font-semibold","text-gray-900","text-white"],["src","../../../assets/images/logo.png","alt","logo",1,"w-8","h-8","mr-2"],[1,"w-full","bg-white","rounded-lg","shadow","dark:border","md:mt-0","sm:max-w-md","xl:p-0","dark:bg-gray-800","dark:border-gray-700"],[1,"p-6","space-y-4","md:space-y-6","sm:p-8"],[1,"text-xl","font-bold","leading-tight","tracking-tight","text-gray-900","md:text-2xl","dark:text-white"],[1,"space-y-4","md:space-y-6"],["for","nombre",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","text","name","nombre","id","nombre","formControlName","nombre","placeholder","","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],["for","apellidos",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","text","name","apellidos","id","apellidos","formControlName","apellidos","placeholder","","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],["for","telefono",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","tel","name","telefono","id","telefono","formControlName","telefono","placeholder","","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],["for","email",1,"block","mb-2","text-sm","font-medium","text-gray-900","dark:text-white"],["type","email","name","email","id","email","formControlName","email","readonly","","placeholder","example@email.com","required","",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],[1,"mb-3","mt-3"],["for","rol",1,"form-label","textoPrincipal"],["id","rol","name","rol","formControlName","rol","required","",1,"form-select"],["value","Usuario"],["value","Periodista"],["value","Admin"],["type","submit",1,"btn","btn-primary","mt-5"],[1,"bi","bi-person-fill-gear","fs-5"]],template:function(o,a){1&o&&(e.TgZ(0,"section",0)(1,"form",1),e.NdJ("ngSubmit",function(){return a.editarUsuario()}),e.TgZ(2,"div",2)(3,"a",3),e._UZ(4,"img",4),e._uU(5," PANVDEV "),e.qZA(),e.TgZ(6,"div",5)(7,"div",6)(8,"h1",7),e._uU(9," Registro "),e.qZA(),e.TgZ(10,"div",8)(11,"div")(12,"label",9),e._uU(13,"Nombre"),e.qZA(),e._UZ(14,"input",10),e.qZA(),e.TgZ(15,"div")(16,"label",11),e._uU(17,"Apellidos"),e.qZA(),e._UZ(18,"input",12),e.qZA(),e.TgZ(19,"div")(20,"label",13),e._uU(21,"Tel\xe9fono"),e.qZA(),e._UZ(22,"input",14),e.qZA(),e.TgZ(23,"div")(24,"label",15),e._uU(25,"Your email"),e.qZA(),e._UZ(26,"input",16),e.qZA(),e.TgZ(27,"div",17)(28,"label",18),e._uU(29,"Cambiar Rol"),e.qZA(),e.ynx(30),e.TgZ(31,"select",19)(32,"option",20),e._uU(33,"Usuario"),e.qZA(),e.TgZ(34,"option",21),e._uU(35,"Periodista"),e.qZA(),e.TgZ(36,"option",22),e._uU(37,"Administrador"),e.qZA()(),e.BQk(),e.qZA()()()(),e.TgZ(38,"button",23)(39,"i",24),e._uU(40," Guardar cambios"),e.qZA()()()()()),2&o&&(e.xp6(1),e.Q6J("formGroup",a.formularioEditarUsuario))},dependencies:[i._Y,i.YN,i.Kr,i.Fj,i.EJ,i.JJ,i.JL,i.Q7,i.sg,i.u]})}return t})(),q=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#r=this.\u0275cmp=e.Xpm({type:t,selectors:[["app-administracion-principal"]],decls:1,vars:0,template:function(o,a){1&o&&e._UZ(0,"router-outlet")},dependencies:[l.lC]})}return t})();var w=n(5861),C=n(1374);const h=function(){var t=(0,w.Z)(function*(u,r){const o=(0,e.f3M)(b.e),a=(0,e.f3M)(l.F0),s=(0,e.f3M)(g.g);try{const d=yield o.obtenerUsuarioActual();if(console.log("Usuario actual en Firestore:",d),d){const p=yield s.obtenerPorFiltro("usuarios","email",d.email).pipe((0,C.P)()).toPromise();return console.log("Usuario encontrado en Firestore:",p),p.length>0&&"Admin"===p[0].rol?(console.log("Acceso permitido"),!0):(console.log("Acceso denegado"),a.navigate(["/principal/login"]),!1)}return console.log("No hay usuario actual en Firestore"),a.navigate(["/principal/login"]),!1}catch(d){return console.error("Error al obtener el usuario actual:",d),!1}});return function(r,o){return t.apply(this,arguments)}}(),P=[{path:"",component:q,children:[{path:"ver-panel",component:_,canActivate:[h]},{path:"editar-usuario/:id",component:T,canActivate:[h]}]}];let E=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#r=this.\u0275mod=e.oAB({type:t});static#t=this.\u0275inj=e.cJS({imports:[l.Bz.forChild(P),l.Bz]})}return t})(),N=(()=>{class t{static#e=this.\u0275fac=function(o){return new(o||t)};static#r=this.\u0275mod=e.oAB({type:t});static#t=this.\u0275inj=e.cJS({imports:[c.ez,E,i.UX]})}return t})()}}]);